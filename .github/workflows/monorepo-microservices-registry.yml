name: Azure Publish Images to Registry

on:
  workflow_dispatch:

jobs:
    build_and_push_to_registry:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout GitHub Action
          uses: actions/checkout@v2

        - name: Login via Azure CLI
          uses: Azure/docker-login@v1
          with:
              login-server: devcontainerregistryre02.azurecr.io
              username: ${{ SECRETS.REGISTRY_USERNAME }}
              password: ${{ SECRETS.REGISTRY_PASSWORD }}

        - name: Publish Company.Department to Registry
          run: |
            docker build -f ./Company.Department/Dockerfile -t devcontainerregistryre02.azurecr.io/company-department::${{ github.sha }} .
            docker push devcontainerregistryre02.azurecr.io/company-department::${{ github.sha }}
            
        - name: Publish Microservices.Catalogue to Registry
          run: |
            docker build -f ./Microservices.Catalogue/Dockerfile -t devcontainerregistryre02.azurecr.io/microservices-catalogue::${{ github.sha }} .
            docker push devcontainerregistryre02.azurecr.io/microservices-catalogue::${{ github.sha }}            
